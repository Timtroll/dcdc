# Описание архитектуры #

Вся схема разбита на 5 [главных](#Главные_задачи) задач, 2 [побочные](#Побочные_задачи) и 2 [бинарных семафора](#Бинарные_семафоры).



## <a name="Главные_задачи">Главные задачи</a> ##

### 1.TaskUARTGetData ###


В этой задаче происходит прием данных из **UART** и запись в очередь посредством использования функции FreeRTOS

	osMessagePut(RX_Queue, QUEUE_SIZE, uint16_t)

Сама очередь постороена по принципу FIFO, что позволяет не потерять новые данные, пришедшие с UART'а. 

### 2.TaskComputeCommand ###


В этой задаче данные из очереди отправляются в [парсер](https://github.com/AFAlexandrov/command-parser). В результате анализа из команды **может быть** выделено 3 типа данных:

1.	Параметр

Найденный параметр **не обрабатывается** самим парсером, а отправляется в задачу с выполнением действий для [постобработки](#Posprocessing) и преобразование в значение. 

2.	Действие

Найденное действие готово для дальнейшего выполнения без последующей обработки.  

3.	Ответ

Из команды парсер, также может выделить ответ, который будет отобрабаться у пользователя в консоли об успешном/не успешном действии или ввиде системной информации. 

---
Система может не брать информацию, которую обнаружил в команде парсер. 

Суть этого блока заключается в том, что вся найденная парсером информация хранится **только после обработки** конкретной команды, а при следующей итерации старая информация будет утеряна или вовремя выполнения действия задача выполения действий получит некорректное действие или параметр. 

Для предотвращения коллизий были "повешены" [бинарные семафоры](#Бинарные_семафоры).  

### 3.TaskActionCommand ###

/*in progress*/

#### <a name="Posprocessing">Блок "Posprocessing"</a> #### 

Переданный из парсера параметр необходимо конкретезировать для дальнейшего использования действиями или отправки в ответ. Например, получаения значения напряжения отсечки или типа аккумулятора. 

### 4.TaskPreparationResponse  ###

/*in progress*/

### 5.TaskUARTPushData ###


## <a name="Побочные_задачи">Побочные задачи</a> ##

Эти задачи имеют более низкий приоритет по сравнение с [главными](#Главные_задачи), поэтому для их выполнения необходимо переводить вышестоящие по приоритету задачи в состояние **Blocked**, что может произойти различными способами. 

### 1.sideTaskDisplayPushData ###

/*in progress*/

### 2.sideTaskKBGetAction ###

/*in progress*/

## <a name="Бинарные_семафоры">Бинарные семафоры</a> ##

Семафоры не дадут выпонятся другому коду, точнее нельзя будет выполнять разбор команды, пока происходит выполнение действия и наоборот.  

### 1.BinSemNoParseGoAction ###

Запрет выполения разбора команды во время действия

/*in progress*/


### 2.BinSemNoActionGoParse ###

Запрет выполнения действия во время разбора команды

/*in progress*/

---

Однако другие задачи могут выполнять свои действия, ведь они не влекут потерую данных. Например, задача **TaskPreparationResponse** может из парсера извлечь Response или другие другие задачи взаимодействовать друг с другом. 